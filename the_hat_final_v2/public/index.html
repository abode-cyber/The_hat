<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Hat - Ø°Ø§ Ù‡Ø§Øª</title>
    <link rel="stylesheet" href="style.css">
    <!-- Ù…ÙƒØªØ¨Ø© Socket.io Ù…Ù† CDN Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© */
        #initial-loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid #333;
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØªØ¸Ù‡Ø± Ø£ÙˆÙ„ Ø´ÙŠØ¡ -->
    <div id="initial-loader">
        <div class="spinner"></div>
        <h3 style="color: var(--accent-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø·Ø¨Ø®...</h3>
    </div>

    <header>
        <div class="logo-container">
            <!-- Ø§Ù„Ù„ÙˆÙ‚Ùˆ Ø­Ù‚Ùƒ ÙŠØ§ ÙˆØ­Ø´ -->
            <img src="./logo.webp" alt="The Hat Logo" class="logo-img" onerror="this.style.display='none'; document.querySelector('.logo-container').innerText='THE HAT'">
        </div>
        <h1>THE HAT | Ø°Ø§ Ù‡Ø§Øª</h1>
    </header>

    <div class="container">

        <!-- ================= ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ ================= -->
        <div id="branch-page" class="page active">
            <h2 style="text-align: center; margin-bottom: 20px; color: #aaa;">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ùƒ</h2>
            
            <div class="branch-card" style="margin-bottom: 20px;">
                <button class="btn" onclick="selectBranch('okaz')">ÙØ±Ø¹ Ø¹ÙƒØ§Ø¸</button>
            </div>
            
            <div class="branch-card">
                <button class="btn" onclick="selectBranch('halqa')">ÙØ±Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø©</button>
            </div>

            <div style="margin-top: 40px; text-align: center;">
                <p style="color: #666; font-size: 0.9rem;">Ù…ÙˆØ¸ÙØŸ</p>
                <button onclick="showPage('admin-login')" style="background: none; border: none; color: #444; text-decoration: underline; cursor: pointer;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ø®</button>
            </div>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ ================= -->
        <div id="menu-page" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="selected-branch-title">Ø§Ù„Ù…Ù†ÙŠÙˆ</h2>
                <button onclick="showPage('branch-page')" style="background: none; border: none; color: #aaa; cursor: pointer;">ØªØºÙŠÙŠØ± Ø§Ù„ÙØ±Ø¹</button>
            </div>

            <div id="menu-items">
                <!-- Ø§Ù„Ø£ØµÙ†Ø§Ù Ø¨ØªÙ†Ø²Ù„ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>

            <!-- Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
            <div id="cart-float" class="cart-float" style="display: none;" onclick="showPage('checkout-page')">
                <span id="cart-count">0 Ù…Ù†ØªØ¬Ø§Øª</span>
                <span id="cart-total">0 Ø±ÙŠØ§Ù„</span>
                <span>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ &larr;</span>
            </div>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ================= -->
        <div id="checkout-page" class="page">
            <button onclick="showPage('menu-page')" class="btn btn-secondary" style="margin-bottom: 20px;">&rarr; Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ù†ÙŠÙˆ</button>
            
            <h2 style="margin-bottom: 20px; color: var(--accent-color);">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h2>
            <div id="checkout-items" style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù‡Ù†Ø§ -->
            </div>

            <h3 style="margin-bottom: 15px;">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ ØºØ§Ù„ÙŠ</h3>
            <form id="order-form" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…</label>
                    <input type="text" id="customer-name" required placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ">
                    <small id="name-error" style="color: var(--danger-color); display: none;">Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨ ÙŠØ§ ØºØ§Ù„ÙŠ</small>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù„Ø§Ø²Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…)</label>
                    <input type="tel" id="customer-phone" required placeholder="05xxxxxxxx" maxlength="10">
                    <small id="phone-error" style="color: var(--danger-color); display: none;">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ø§Ø²Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…</small>
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ ÙˆÙ…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±ÙÙƒ)</label>
                    <input type="text" id="car-info" required placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙƒØ§Ù…Ø±ÙŠ Ø¨ÙŠØ¶Ø§Ø¡ 2020">
                </div>
                
                <button type="submit" id="submit-btn" class="btn">
                    <span id="btn-text">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)</span>
                    <span id="btn-loader" style="display: none;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„... â³</span>
                </button>
            </form>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨) ================= -->
        <div id="invoice-page" class="page">
            <div style="text-align: center; padding: 30px 0;">
                <div style="font-size: 4rem; color: var(--success-color); margin-bottom: 10px;">&#10004;</div>
                <h2 style="color: var(--accent-color);">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
                <p style="color: #aaa; margin-top: 10px;">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <span id="invoice-id" style="color: white; font-weight: bold;">#</span></p>
            </div>

            <div class="order-card" style="text-align: center;">
                <p>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</p>
                <h1 id="invoice-status" style="font-size: 2rem; margin: 15px 0; color: var(--accent-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</h1>
                <p style="font-size: 0.9rem; color: #888;">Ø®Ù„ÙŠÙƒ ÙÙŠ Ù‡Ø§Ù„ØµÙØ­Ø©ØŒ Ø¨ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù…Ø§ ÙŠØ¬Ù‡Ø² Ø·Ù„Ø¨Ùƒ</p>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
                <div id="invoice-details"></div>
                <div style="margin-top: 15px; font-weight: bold; font-size: 1.2rem; text-align: left;">
                    Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="invoice-total" style="color: var(--accent-color);">0</span> Ø±ÙŠØ§Ù„
                </div>
            </div>
            
            <button onclick="location.reload()" class="btn btn-secondary" style="margin-top: 30px;">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <!-- ================= ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† ================= -->
        <div id="admin-login" class="page">
            <h2 style="text-align: center; margin-bottom: 20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ø¨Ø® / Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h2>
            <div class="form-group">
                <label>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</label>
                <input type="password" id="admin-pin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²" style="text-align: center; letter-spacing: 5px; font-size: 1.5rem;">
            </div>
            <button onclick="checkAdminPin()" class="btn">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="showPage('branch-page')" class="btn btn-secondary">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- ================= ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ù…Ø·Ø¨Ø®) ================= -->
        <div id="admin-dashboard" class="page">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                <h2>ğŸ‘¨â€ğŸ³ Ø§Ù„Ù…Ø·Ø¨Ø® (Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­ÙŠØ©)</h2>
                <div>
                    <button onclick="enableSound()" id="sound-btn" style="background: #333; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-left: 5px;">ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
                    <button onclick="showPage('branch-page')" style="background: #333; color: white; border: none; padding: 5px 10px; border-radius: 4px;">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>

            <div id="admin-orders-list">
                <p style="text-align: center; color: #666; margin-top: 50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹...</p>
            </div>
        </div>

    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
    <div id="location-modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px; color: var(--accent-color);">ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ÙØ±Ø¹</h3>
            <p style="margin-bottom: 20px;">ØªØ¨ÙŠ Ù†ÙØªØ­ Ù„Ùƒ Ù‚ÙˆÙ‚Ù„ Ù…Ø§Ø¨ ÙˆÙ„Ø§ ØªØ¯Ù„ Ø§Ù„Ø·Ø±ÙŠÙ‚ØŸ</p>
            <button id="maps-btn" class="btn">ÙˆØ¯Ù†ÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹ (Google Maps)</button>
            <button onclick="closeModalAndGoToMenu()" class="btn btn-secondary">Ø£Ø¹Ø±Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
    </div>

    <!-- ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ù…Ø®ÙÙŠ) -->
    <audio id="notification-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        // ================= Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©) =================
        const menuItems = [
            // 1. Ù‚Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ§Ù„Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª
            { id: 1, name: "Ù‡Ø§Øª ÙˆØ¬Ø¨Ø© Ù„Ø­Ù… (950 cal)", price: 23, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 2, name: "Ù‡Ø§Øª ÙˆØ¬Ø¨Ø© Ø¯Ø¬Ø§Ø¬ (830 cal)", price: 21, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 3, name: "Ù‡Ø§Øª Ø´ÙˆØ³ Ù„Ø­Ù… (490 cal)", price: 16, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 4, name: "Ù‡Ø§Øª Ø´ÙˆØ³ Ø¯Ø¬Ø§Ø¬ (400 cal)", price: 14, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 5, name: "Ù‡Ø§Øª Ø¨Ø±Ø¬Ø± Ù„Ø­Ù… (450 cal)", price: 14, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 6, name: "Ù‡Ø§Øª Ø¨Ø±Ø¬Ø± Ø¯Ø¬Ø§Ø¬ (360 cal)", price: 12, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 7, name: "Ù‡Ø§Øª Ø³ØªÙŠÙƒ (Ù„Ø­Ù…/Ø¯Ø¬Ø§Ø¬)", price: 13, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 8, name: "Ù‡Ø§Øª Ø³ØªÙŠÙƒ ÙˆØ¬Ø¨Ø©", price: 23, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 9, name: "Ù‡Ø§Øª Ø­Ø³Ù†ÙŠ (350 cal)", price: 16, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },
            { id: 10, name: "Ù‡Ø§Øª Ø­Ø³Ù†ÙŠ ÙˆØ¬Ø¨Ø©", price: 18, category: "ÙˆØ¬Ø¨Ø§Øª" },
            { id: 11, name: "Ù‡Ø§Øª Ø³Ø¨ÙŠØ´Ù„ Ø­Ø³Ù†ÙŠ (390 cal)", price: 18, category: "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª" },

            // 2. Ù‚Ø³Ù… Ù‡Ø§Øª Ø¨Ø·Ø§Ø·Ø³
            { id: 12, name: "Ø¨Ø·Ø§Ø·Ø³ ÙˆÙŠØ¯Ø¬Ø± (200 cal)", price: 9, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 13, name: "Ø¨Ø·Ø§Ø·Ø³ Ø¨Ø§Ù„Ø¨ØµÙ„ Ø§Ù„Ù…Ù‚Ø±Ù…Ø´ (220 cal)", price: 11, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 14, name: "Ø¨Ø·Ø§Ø·Ø³ Ø¨Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ù…ÙØ±ÙˆÙ… (245 cal)", price: 12, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 15, name: "Ø¨Ø·Ø§Ø·Ø³ Ù…ÙƒØ¹Ø¨Ø§Øª (200 cal)", price: 10, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 16, name: "Ø¨Ø·Ø§Ø·Ø³ Ø­Ù„ÙˆØ© Ù…Ø¹ ØµÙˆØµ ØªÙƒØ³Ø§Ø³ (130 cal)", price: 11, category: "Ø¨Ø·Ø§Ø·Ø³" },
            { id: 17, name: "Ø¨Ø·Ø§Ø·Ø³ Ø¨Ø§Ù„Ø¯Ø¬Ø§Ø¬ Ø§Ù„Ù…ÙØ±ÙˆÙ… (238 cal)", price: 12, category: "Ø¨Ø·Ø§Ø·Ø³" },

            // 3. Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª ÙˆØ§Ù„ØµÙˆØµØ§Øª
            { id: 18, name: "ØµÙˆØµ Ø°Ø§ Ù‡Ø§Øª", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 19, name: "ØµÙˆØµ ØªÙƒØ³Ø§Ø³", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 20, name: "ØµÙˆØµ Ø¬Ø¨Ù†", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 21, name: "Ù‡Ù„Ø§Ø¨ÙŠÙ†Ùˆ", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 22, name: "Ø´Ø±ÙŠØ­Ø© Ø¬Ø¨Ù†", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 23, name: "Ø¨ØµÙ„ Ù…Ù‚Ø±Ù…Ø´", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },
            { id: 24, name: "Ø´ÙŠØªÙˆØ³", price: 2, category: "Ø¥Ø¶Ø§ÙØ§Øª" },

            // 4. Ù‚Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª
            { id: 25, name: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª ØºØ§Ø²ÙŠØ© (Ø¨ÙŠØ¨Ø³ÙŠØŒ Ø¯ÙŠÙˆØŒ Ø³ÙÙ† Ø£Ø¨ØŒ Ù…ÙŠØ±Ù†Ø¯Ø§)", price: 4, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" },
            { id: 26, name: "Ù…Ø§Ø¡", price: 1, category: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª" }
        ];

        const branches = {
            'okaz': 'https://maps.app.goo.gl/tDuWBrnBc27WJgiSA?g_st=ipc',
            'halqa': 'https://maps.app.goo.gl/eWtxLwmejQPABrAt5?g_st=ipc'
        };

        // ================= Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =================
        let cart = [];
        let currentBranch = '';
        let socket = io(); // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
        let myOrderId = null; // Ø¹Ø´Ø§Ù† Ø§Ù„Ø²Ø¨ÙˆÙ† ÙŠØ¹Ø±Ù Ø·Ù„Ø¨Ù‡
        let allOrders = []; // Ù†Ø®Ø²Ù† ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ÙƒØ§Ø´ÙŠØ± ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙˆØ­ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
        function getShortId(longId) {
            return longId.slice(-4);
        }

        // ================= Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù‚ÙˆÙŠ) =================
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
            
            // Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹
            localStorage.setItem('currentPage', pageId);
        }

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
        window.onload = function() {
            const savedPage = localStorage.getItem('currentPage');
            const savedOrderId = localStorage.getItem('myOrderId');
            const savedBranch = localStorage.getItem('selectedBranch');

            // 1. Ù„Ùˆ ÙƒØ§Ù† Ø£Ø¯Ù…Ù†ØŒ Ù†Ø±Ø¬Ø¹Ù‡ Ù„Ù„Ù…Ø·Ø¨Ø® ÙÙˆØ±Ø§Ù‹
            if (savedPage === 'admin-dashboard') {
                showPage('admin-dashboard');
                return;
            }

            // 2. Ù„Ùˆ ÙƒØ§Ù† Ø²Ø¨ÙˆÙ† ÙˆØ¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨ Ù†Ø´Ø·ØŒ Ù†Ø±Ø¬Ø¹Ù‡ Ù„Ù„ÙØ§ØªÙˆØ±Ø© ÙÙˆØ±Ø§Ù‹
            if (savedOrderId) {
                myOrderId = savedOrderId;
                showPage('invoice-page');
                // Ù†Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
                socket.emit('check-order-status', myOrderId);
                return;
            }

            // 3. Ù„Ùˆ ÙƒØ§Ù† Ø²Ø¨ÙˆÙ† ÙˆØ§Ø®ØªØ§Ø± Ø§Ù„ÙØ±Ø¹ Ø¨Ø³ Ù„Ø³Ù‡ Ù…Ø§ Ø·Ù„Ø¨ØŒ Ù†Ø±Ø¬Ø¹Ù‡ Ù„Ù„Ù…Ù†ÙŠÙˆ
            if (savedPage === 'menu-page' && savedBranch) {
                currentBranch = savedBranch;
                document.getElementById('selected-branch-title').innerText = 
                    currentBranch === 'okaz' ? 'Ù…Ù†ÙŠÙˆ ÙØ±Ø¹ Ø¹ÙƒØ§Ø¸' : 'Ù…Ù†ÙŠÙˆ ÙØ±Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø©';
                renderMenu();
                showPage('menu-page');
                return;
            }

            // 4. ØºÙŠØ± ÙƒØ°Ø§ØŒ ÙŠØ±ÙˆØ­ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            showPage('branch-page');
        };

        function selectBranch(branch) {
            currentBranch = branch;
            localStorage.setItem('selectedBranch', branch); // Ù†Ø­ÙØ¸ Ø§Ù„ÙØ±Ø¹
            
            const modal = document.getElementById('location-modal');
            const mapsBtn = document.getElementById('maps-btn');
            
            // Ù†Ø¬Ù‡Ø² Ø²Ø± Ø§Ù„Ù…Ø§Ø¨ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØµØ­
            mapsBtn.onclick = () => {
                window.open(branches[branch], '_blank');
                closeModalAndGoToMenu();
            };
            
            modal.classList.add('active');
        }

        function closeModalAndGoToMenu() {
            document.getElementById('location-modal').classList.remove('active');
            document.getElementById('selected-branch-title').innerText = 
                currentBranch === 'okaz' ? 'Ù…Ù†ÙŠÙˆ ÙØ±Ø¹ Ø¹ÙƒØ§Ø¸' : 'Ù…Ù†ÙŠÙˆ ÙØ±Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø©';
            renderMenu();
            showPage('menu-page');
        }

        // ================= Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…Ù†ÙŠÙˆ =================
        function renderMenu() {
            const container = document.getElementById('menu-items');
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
            const categories = {
                'ÙˆØ¬Ø¨Ø§Øª': [],
                'Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª': [],
                'Ø¨Ø·Ø§Ø·Ø³': [],
                'Ø¥Ø¶Ø§ÙØ§Øª': [],
                'Ù…Ø´Ø±ÙˆØ¨Ø§Øª': []
            };
            
            menuItems.forEach(item => {
                if (categories[item.category]) {
                    categories[item.category].push(item);
                }
            });

            let html = '';
            for (const [catName, items] of Object.entries(categories)) {
                if (items.length > 0) {
                    html += `<h3 style="color: var(--accent-color); margin: 20px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px;">${catName}</h3>`;
                    html += items.map(item => `
                        <div class="menu-item">
                            <div class="item-info">
                                <h3>${item.name}</h3>
                                <div class="item-price">${item.price} Ø±ÙŠØ§Ù„</div>
                            </div>
                            <button class="add-btn" onclick="addToCart(${item.id})">+</button>
                        </div>
                    `).join('');
                }
            }
            container.innerHTML = html;
        }

        function addToCart(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            cart.push(item);
            updateCartUI();
            
            // Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ· Ù„Ù„Ø³Ù„Ø© Ø¹Ø´Ø§Ù† ÙŠØ­Ø³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const cartFloat = document.getElementById('cart-float');
            cartFloat.style.transform = 'scale(1.1)';
            setTimeout(() => cartFloat.style.transform = 'scale(1)', 200);
        }

        function updateCartUI() {
            const count = cart.length;
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            
            document.getElementById('cart-count').innerText = `${count} Ù…Ù†ØªØ¬Ø§Øª`;
            document.getElementById('cart-total').innerText = `${total} Ø±ÙŠØ§Ù„`;
            
            const cartFloat = document.getElementById('cart-float');
            if (count > 0) cartFloat.style.display = 'flex';
            
            // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ ÙƒÙ…Ø§Ù†
            renderCheckout();
        }

        function renderCheckout() {
            const container = document.getElementById('checkout-items');
            if (cart.length === 0) {
                container.innerHTML = '<p>Ø³Ù„ØªÙƒ ÙØ§Ø¶ÙŠØ© ÙŠØ§ Ø§Ù„Ø­Ø¨ÙŠØ¨</p>';
                return;
            }

            // Ù†Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©
            const grouped = {};
            cart.forEach(item => {
                if (!grouped[item.id]) grouped[item.id] = { ...item, qty: 0 };
                grouped[item.id].qty++;
            });

            container.innerHTML = Object.values(grouped).map(item => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px;">
                    <span>${item.name} x${item.qty}</span>
                    <span>${item.price * item.qty} Ø±ÙŠØ§Ù„</span>
                </div>
            `).join('') + `
                <div style="text-align: left; font-weight: bold; margin-top: 15px; font-size: 1.2rem; color: var(--accent-color);">
                    Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${cart.reduce((sum, i) => sum + i.price, 0)} Ø±ÙŠØ§Ù„
                </div>
            `;
        }

        // ================= Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ =================
        function submitOrder(e) {
            e.preventDefault();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const name = document.getElementById('customer-name').value.trim();
            const phone = document.getElementById('customer-phone').value.trim();
            const car = document.getElementById('car-info').value.trim();
            
            let isValid = true;

            // ØªØ­Ù‚Ù‚ Ø§Ù„Ø§Ø³Ù…
            if (name.length < 2) {
                document.getElementById('name-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('name-error').style.display = 'none';
            }

            // ØªØ­Ù‚Ù‚ Ø§Ù„Ø¬ÙˆØ§Ù„ (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆØ·ÙˆÙ„Ù‡ 10)
            const phoneRegex = /^05\d{8}$/;
            if (!phoneRegex.test(phone)) {
                document.getElementById('phone-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('phone-error').style.display = 'none';
            }

            if (!isValid) return;
            if (cart.length === 0) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©!');

            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ù‚
            const btn = document.getElementById('submit-btn');
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            
            btn.disabled = true;
            btn.style.opacity = '0.7';
            btnText.style.display = 'none';
            btnLoader.style.display = 'inline';

            const orderData = {
                customerName: name,
                customerPhone: phone,
                carInfo: car,
                branch: currentBranch,
                items: cart,
                total: cart.reduce((sum, i) => sum + i.price, 0)
            };

            // Ù†Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø³ÙŠØ±ÙØ±
            socket.emit('new-order', orderData);
        }

        // ================= Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ø£Ø¯Ù…Ù†) =================
        function checkAdminPin() {
            const pin = document.getElementById('admin-pin').value;
            if (pin === '1234') {
                showPage('admin-dashboard');
                // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø¹Ù†Ø¯Ù†Ø§ ÙÙˆØ±Ø§Ù‹
                renderAdminOrders(allOrders);
            } else {
                alert('Ø§Ù„Ø±Ù…Ø² ØºÙ„Ø· ÙŠØ§ Ø±ÙŠØ³!');
            }
        }

        function renderAdminOrders(orders) {
            const activeContainer = document.getElementById('admin-orders-list');
            const archiveContainer = document.getElementById('archived-orders-list');
            
            // Ù†ÙØµÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: Ø§Ù„Ù†Ø´Ø·Ø© (pending, preparing, ready) ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ (archived)
            const activeOrders = orders.filter(o => o.status !== 'archived').sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const archivedOrders = orders.filter(o => o.status === 'archived').sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            // Ø±Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            if (activeOrders.length === 0) {
                activeContainer.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©...</p>';
            } else {
                activeContainer.innerHTML = activeOrders.map(order => createOrderCard(order)).join('');
            }

            // Ø±Ø³Ù… Ø§Ù„Ø£Ø±Ø´ÙŠÙ
            if (archivedOrders.length === 0) {
                archiveContainer.innerHTML = '<p style="text-align: center; color: #666; font-size: 0.8rem;">Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙØ§Ø¶ÙŠ</p>';
            } else {
                archiveContainer.innerHTML = archivedOrders.map(order => createOrderCard(order, true)).join('');
            }
        }

        function createOrderCard(order, isArchived = false) {
            const timeAgo = Math.floor((Date.now() - new Date(order.timestamp)) / 60000);
            
            return `
                <div class="order-card ${order.status === 'ready' ? 'ready-glow' : ''}" style="${isArchived ? 'border-color: #444; opacity: 0.8;' : ''}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <div>
                            <span class="status-badge status-${order.status === 'pending' ? 'pending' : (order.status === 'ready' ? 'ready' : (order.status === 'archived' ? 'ready' : 'preparing'))}">
                                ${getStatusText(order.status)}
                            </span>
                            <h3 style="margin: 5px 0;">${order.customerName}</h3>
                            <p style="color: #aaa; font-size: 0.9rem;">${order.carInfo}</p>
                        </div>
                        <div style="text-align: left;">
                            <div style="font-weight: bold; font-size: 1.2rem;">#${getShortId(order.id)}</div>
                            <div style="font-size: 0.8rem; color: #666;">Ù…Ù†Ø° ${timeAgo} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                            <div style="font-size: 0.8rem; color: var(--accent-color); margin-top: 5px;">${order.branch === 'okaz' ? 'Ø¹ÙƒØ§Ø¸' : 'Ø§Ù„Ø­Ù„Ù‚Ø©'}</div>
                        </div>
                    </div>

                    <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                        ${order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 3px;">
                                <span>${item.name}</span>
                                <span>${item.price}</span>
                            </div>
                        `).join('')}
                        <div style="border-top: 1px solid #444; margin-top: 5px; padding-top: 5px; font-weight: bold; text-align: left;">
                            Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø±ÙŠØ§Ù„
                        </div>
                    </div>

                    ${!isArchived ? `
                    <div class="action-buttons">
                        ${order.status !== 'preparing' ? `<button onclick="updateStatus('${order.id}', 'preparing')" class="btn" style="background: #2196F3;">ğŸ‘¨â€ğŸ³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>` : ''}
                        ${order.status !== 'ready' ? `<button onclick="updateStatus('${order.id}', 'ready')" class="btn" style="background: var(--success-color);">âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>` : ''}
                        ${order.status === 'ready' ? `<button onclick="updateStatus('${order.id}', 'archived')" class="btn" style="background: #666;">ğŸ“¥ Ø£Ø±Ø´ÙØ©</button>` : ''}
                        <button onclick="deleteOrder('${order.id}')" class="btn" style="background: var(--danger-color);">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function getStatusText(status) {
            if (status === 'pending') return 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸ†•';
            if (status === 'preparing') return 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ² ğŸ³';
            if (status === 'ready') return 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… âœ…';
            return status;
        }

        function updateStatus(orderId, status) {
            socket.emit('update-status', { orderId, status });
        }

        function deleteOrder(orderId) {
            if (confirm('Ø£ÙƒÙŠØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                socket.emit('delete-order', orderId);
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ø´ÙØ© ØµØ§Ø±Øª Ù…Ø¯Ù…Ø¬Ø© ÙÙŠ updateStatus Ø¨ØªÙ…Ø±ÙŠ Ø§Ù„Ø­Ø§Ù„Ø© 'archived'

        function enableSound() {
            const audio = document.getElementById('notification-sound');
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
                document.getElementById('sound-btn').innerText = 'âœ… Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„';
                document.getElementById('sound-btn').style.color = '#4CAF50';
            }).catch(e => alert('Ù„Ø§Ø²Ù… ØªØ¶ØºØ· Ø¹Ø´Ø§Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØµÙˆØª'));
        }

        // ================= Socket.io Listeners (Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶) =================
        
        socket.on('connect', () => {
            console.log('Connected to server');
            // Ù†Ø®ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù…Ø§ Ù†ØªØµÙ„
            document.getElementById('initial-loader').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('initial-loader').style.display = 'none';
            }, 500);

            // Ù„Ùˆ Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨ Ù‚Ø¯ÙŠÙ…ØŒ Ù†Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙ‡ ÙÙˆØ±Ø§Ù‹
            if (myOrderId) {
                // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù…Ø§ Ø¹Ù†Ø¯Ù†Ø§ Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ©ØŒ Ù†Ù†ØªØ¸Ø± initial-orders Ø£Ùˆ order-update
                // Ù„ÙƒÙ† Ø§Ù„Ø£ÙØ¶Ù„ Ù†Ø±Ø³Ù„ Ø·Ù„Ø¨ ØµØ±ÙŠØ­ Ù„Ùˆ Ø§Ø­ØªØ¬Ù†Ø§ØŒ Ø­Ø§Ù„ÙŠØ§Ù‹ initial-orders ØªÙƒÙÙŠ
            }
        });

        // Ù„Ùˆ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ù†Ø±Ø¬Ø¹ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØ¹Ù„Ù‚ Ø§Ù„Ø²Ø¨ÙˆÙ†
        socket.on('disconnect', () => {
            document.getElementById('initial-loader').style.display = 'flex';
            document.getElementById('initial-loader').style.opacity = '1';
            document.querySelector('#initial-loader h3').innerText = 'Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...';
        });

        // Ø£ÙˆÙ„ Ù…Ø§ Ù†Ø´Ø¨ÙƒØŒ Ù†Ø³ØªÙ„Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
        socket.on('initial-orders', (orders) => {
            console.log('Initial orders received:', orders.length);
            allOrders = orders; // Ù†Ø­ÙØ¸Ù‡Ø§ Ø¹Ù†Ø¯Ù†Ø§
            
            // Ù†Ø­Ø¯Ø« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø¯Ø§Ø¦Ù…Ø§Ù‹
            renderAdminOrders(orders);

            // Ù„Ùˆ Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨ØŒ Ù†Ø­Ø¯Ø« Ø­Ø§Ù„ØªÙ‡ ÙÙˆØ±Ø§Ù‹
            if (myOrderId) {
                const myOrder = orders.find(o => o.id === myOrderId);
                if (myOrder) {
                    updateInvoiceUI(myOrder);
                }
            }
        });

        // ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø²Ø¨ÙˆÙ† (Ø¹Ø´Ø§Ù† Ù†ÙˆÙ‚Ù Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ù‚)
        socket.on('order-confirmed', (orderId) => {
            console.log('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø±Ù‚Ù…:', orderId);
            myOrderId = orderId; 
            localStorage.setItem('myOrderId', orderId); // Ø­ÙØ¸ Ø¯Ø§Ø¦Ù… Ù„Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
            
            // Ù†ÙˆÙ‚Ù Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ù‚ ÙˆÙ†Ù†Ù‚Ù„ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
            const btn = document.getElementById('submit-btn');
            if (btn) {
                btn.disabled = false;
                document.getElementById('btn-text').style.display = 'inline';
                document.getElementById('btn-loader').style.display = 'none';
            }
            
            document.getElementById('invoice-id').innerText = '#' + getShortId(orderId);
            showPage('invoice-page'); // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ù…Ø¹ÙŠÙ† (Ù„Ù„Ø²Ø¨ÙˆÙ†)
        socket.on('order-status-update', (orderData) => {
            if (orderData.id === myOrderId) {
                updateInvoiceUI(orderData);
            }
        });

        // Ù„Ù…Ø§ ÙŠØ¬ÙŠ ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ØŒ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø©ØŒ Ø­Ø°Ù)
        socket.on('order-update', (orders) => {
            console.log('ÙˆØµÙ„ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø·Ù„Ø¨Ø§Øª:', orders.length);
            
            // Ù†Ø´ÙŠÙƒ Ù‡Ù„ ÙÙŠÙ‡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¹Ø´Ø§Ù† Ù†Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
            if (orders.length > allOrders.length) {
                const audio = document.getElementById('notification-sound');
                audio.play().catch(e => console.log('Ù„Ø§Ø²Ù… ØªÙØ§Ø¹Ù„ Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØª ÙŠØ´ØªØºÙ„'));
            }
            
            allOrders = orders; 
            renderAdminOrders(orders);

            // Ù„Ùˆ Ø§Ù„Ø²Ø¨ÙˆÙ† ÙØ§ØªØ­ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ Ù†Ø­Ø¯Ø« Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
            if (myOrderId) {
                const myOrder = orders.find(o => o.id === myOrderId);
                if (myOrder) {
                    updateInvoiceUI(myOrder);
                }
            }
        });

        function updateInvoiceUI(order) {
            // Ù‡Ù†Ø§ Ù†Ø­Ø¯Ø« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø§Ù„ØªÙØ§ØµÙŠÙ„)
            // Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„ØµÙØ­Ø© Ø¨Ø³ÙŠØ·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø¨Ù†ÙƒØªÙÙŠ Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ùˆ Ø£Ø¶ÙÙ†Ø§ Ø¹Ù†ØµØ± Ù„Ù‡Ø§
            // Ø£Ùˆ Ù…Ù…ÙƒÙ† Ù†Ø¶ÙŠÙ Ø¹Ù†ØµØ± ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨ÙˆØ¶ÙˆØ­
            const statusContainer = document.querySelector('#invoice-page .status-display');
            if (!statusContainer) {
                // Ù†Ø¶ÙŠÙ Ø¹Ù†ØµØ± Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ùˆ Ù…Ùˆ Ù…ÙˆØ¬ÙˆØ¯
                const container = document.createElement('div');
                container.className = 'status-display';
                container.style.marginTop = '20px';
                container.style.padding = '15px';
                container.style.borderRadius = '8px';
                container.style.background = '#222';
                container.style.textAlign = 'center';
                
                const title = document.querySelector('#invoice-page h2');
                title.parentNode.insertBefore(container, title.nextSibling);
            }
            
            const container = document.querySelector('#invoice-page .status-display');
            container.innerHTML = `
                <h3 style="color: #aaa; margin-bottom: 10px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</h3>
                <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-color);">
                    ${getStatusText(order.status)}
                </div>
            `;
        }



    </script>
</body>
</html>
